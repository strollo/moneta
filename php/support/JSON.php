<?php/****************************************************************************** * Module: support/JSON.php ****************************************************************************** * Description: * General purpose class for managing JSON objects. * * Usage: * 		$s = JSON::toString($v); * 		$j = JSON::fromString($v); *		// writes the response to the client *		JSON::sendJSONResult($_GET, $success, $data);  *****************************************************************************/$BASEPATH = dirname(__FILE__) . '/..'; include_once $BASEPATH . '/support/Log.php';include_once $BASEPATH . '/support/Utils.php';class JSON {	static function toString($v) {		$log = new Log('JSON');		$log->info('toString');		if (!is_null($v)) {			return json_encode($v);		}		return null;	}	static function fromString($v) {		$log = new Log('JSON');		$log->info('fromString');		if (!is_null($v)) {			return json_decode($v);		}		return null;	}		static function sendError($errMessage = null, $includeHeader = true, $get = null) {		if (!isset($get)) {			$get = $_GET;		}		if ($includeHeader) {			header('Content-type: application/json');			if (isset($get) && isset($get['callback'])) {				echo ($get['callback'] . '(');			}		}		echo ('{"error":"true"');		if (!is_null($errMessage)) {			echo(',"msg":"' . $errMessage . '"');		}		echo ('}');				if ($includeHeader && isset($get) && isset($get['callback'])) {			echo (');');		}		die();	}		static function sendSuccess($includeHeader = true, $get = null) {		if (!isset($get)) {			$get = $_GET;		}		if ($includeHeader) {			header('Content-type: application/json');			if (isset($get) && isset($get['callback'])) {				echo ($get['callback'] . '(');			}		}		echo ('{"error":"true"}');		if ($includeHeader && isset($get) && isset($get['callback'])) {			echo (');');		}		die();	}		static function sendJSONResult($get, $data, $msg = null, $totCount = -1, $skipSuccessHeader = false, $skipTotCount = false, $skipDataHeader = false) {		$log = new Log('JSON');		$log->info('writeJSONResult');		header('Content-type: application/json');		if (isset($get) && isset($get['callback'])) {			echo ($get['callback'] . '(');		}				if (is_null($data)) {			$data = array();			$totCount = 0;			$skipDataHeader = true;		} 		else if (is_bool($data)) {			// Only the bool result of a function is returned			if ($data === false) {				JSON::sendError($msg, false);			} else {				if (!is_null($msg)) {					echo('{"success":"true", "msg":"' . $msg . '"}');				} else {					echo('{"success":"true"}');				}			}		} else {			if (!$skipDataHeader) {				echo("{");			}			if (!$skipSuccessHeader) {				echo('"success":"true",');			}			if (!$skipTotCount) {				if ($totCount && $totCount != -1) {					echo('"totalCount":"' . $totCount . '",');				} else {					echo('"totalCount":"' . count($data) . '",');				}			}			if (!$skipDataHeader) {				echo('"data":');			}			echo(json_encode($data));			if (!is_null($msg)) {				echo(', "msg":"' . $msg . '",');			}			if (!$skipDataHeader) {				echo("}");			}		}		if (isset($get) && isset($get['callback'])) {			echo (');');		}	}}?>